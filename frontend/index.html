<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm to Table</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">Farm to Table</div>
        <div class="nav-links">
            <a href="#" id="homeLink" class="nav-link active">Home</a>
            <a href="#" id="loginLink" class="nav-link">Login</a>
            <a href="#" id="dashboardLink" class="nav-link hidden">Dashboard</a>
            <a href="#" id="logoutLink" class="nav-link hidden">Logout</a>
        </div>
    </nav>

    <main>
        <section id="guestHomeSection" class="section active">
            <h1>Welcome to Farm to Table</h1>
            <div class="hero-section">
                <p class="hero-text">Connecting local farmers directly with consumers for fresher produce and fairer prices.</p>
            </div>
            <div class="user-categories">
                <div class="category-card">
                    <img src="images/farmer-icon.png" alt="Farmer Icon" class="category-icon">
                    <h2>Farmer</h2>
                    <p>List and sell your fresh produce directly to consumers</p>
                    <ul class="benefits-list">
                        <li>Set your own prices</li>
                        <li>Reach more customers</li>
                        <li>Reduce food waste</li>
                        <li>Get farming advice</li>
                    </ul>
                    <button onclick="showRegistrationForm('farmer')" class="cta-button">Register as Farmer</button>
                </div>
                <div class="category-card">
                    <img src="images/consumer-icon.png" alt="Consumer Icon" class="category-icon">
                    <h2>Consumer</h2>
                    <p>Buy fresh, local produce directly from farmers</p>
                    <ul class="benefits-list">
                        <li>Access fresh produce</li>
                        <li>Support local farmers</li>
                        <li>Know your food source</li>
                        <li>Get better prices</li>
                    </ul>
                    <button onclick="showRegistrationForm('consumer')" class="cta-button">Register as Consumer</button>
                </div>
            </div>
        </section>

        <!-- Farmer Home Section -->
        <section id="farmerHomeSection" class="section hidden">
            <h1>Welcome Back, <span id="farmerName"></span></h1>
            <div class="dashboard-summary">
                <div class="summary-card">
                    <h3>My Listings</h3>
                    <p id="listingsCount">Loading...</p>
                    <button onclick="navigateTo('farmerDashboard')">Manage Listings</button>
                </div>
                <div class="summary-card">
                    <h3>Quick Add</h3>
                    <button onclick="navigateTo('farmerDashboard')">Add New Produce</button>
                </div>
                <div class="summary-card">
                    <h3>Recent Activity</h3>
                    <div id="recentActivity">Loading...</div>
                </div>
            </div>
        </section>

        <!-- Consumer Home Section -->
        <section id="consumerHomeSection" class="section hidden">
            <h1>Welcome Back, <span id="consumerName"></span></h1>
            <div class="dashboard-summary">
                <div class="summary-card">
                    <h3>Available Produce</h3>
                    <p id="availableCount">Loading...</p>
                    <button onclick="navigateTo('consumerDashboard')">Browse Produce</button>
                </div>
                <div class="summary-card">
                    <h3>Featured Items</h3>
                    <div id="featuredItems">Loading...</div>
                </div>
                <div class="summary-card">
                    <h3>Quick Filters</h3>
                    <button onclick="navigateTo('consumerDashboard', null, { grade: 'A' })">Grade A Produce</button>
                    <button onclick="navigateTo('consumerDashboard', null, { sortBy: 'pricePerMeasurement', sortOrder: 'asc' })">Best Prices</button>
                </div>
            </div>
        </section>

        <!-- Login Section -->
        <section id="loginSection" class="section hidden">
            <div class="form-container">
                <h2>Login</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password:</label>
                        <input type="password" id="loginPassword" name="password" required>
                    </div>
                    <button type="submit">Login</button>
                </form>
                <p>Don't have an account? <a href="#" onclick="navigateTo('home')">Register here</a></p>
            </div>
        </section>

        <!-- Register Section -->
        <section id="registerSection" class="section">
            <div class="form-container">
                <h2>Register</h2>
                
                <!-- User Type Selection -->
                <div id="userTypeSelection" class="active">
                    <h3>I am a:</h3>
                    <div class="user-type-options">
                        <div class="user-type-card" onclick="navigateTo('register', 'farmer')">
                            <h4>Farmer</h4>
                            <p>I want to sell produce</p>
                        </div>
                        <div class="user-type-card" onclick="navigateTo('register', 'consumer')">
                            <h4>Consumer</h4>
                            <p>I want to buy produce</p>
                        </div>
                    </div>
                </div>

                <!-- Registration Form (Initially Hidden) -->
                <form id="registerForm" onsubmit="handleRegister(event)" class="hidden">
                    <input type="hidden" id="userType" name="userType" value="">
                    
                    <!-- Common Fields -->
                    <div class="form-group">
                        <label for="name">Full Name:</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" name="password" minlength="2" required>
                    </div>
                    <div class="form-group">
                        <label for="phoneNumber">Phone Number:</label>
                        <input type="tel" id="phoneNumber" name="phoneNumber">
                    </div>

                    <!-- Consumer Specific Fields -->
                    <div id="consumerFields" class="hidden">
                        <div class="form-group">
                            <label for="businessName">Business Name:</label>
                            <input type="text" id="businessName" name="businessName">
                        </div>
                        <div class="form-group">
                            <label for="businessType">Business Type:</label>
                            <select id="businessType" name="businessType">
                                <option value="">Select business type...</option>
                                <option value="Restaurant">Restaurant</option>
                                <option value="Grocery Store">Grocery Store</option>
                                <option value="Food Processing">Food Processing</option>
                                <option value="Food Bank/Shelter">Food Bank/Shelter</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>

                    <!-- Farmer Specific Fields -->
                    <div id="farmerFields" class="hidden">
                        <div class="form-group">
                            <label for="farmName">Farm Name:</label>
                            <input type="text" id="farmName" name="farmName">
                        </div>
                        <div class="form-group">
                            <label for="farmLocation">Farm Location:</label>
                            <input type="text" id="farmLocation" name="farmLocation">
                        </div>
                        <div class="form-group">
                            <label for="farmSize">Farm Size (acres):</label>
                            <input type="number" id="farmSize" name="farmSize" min="0">
                        </div>
                        <div class="form-group">
                            <label for="certifications">Certifications (optional):</label>
                            <input type="text" id="certifications" name="certifications" placeholder="e.g., Organic, GAP, etc.">
                        </div>
                    </div>

                    <button type="submit">Register</button>
                </form>
                <p>Already have an account? <a href="#" onclick="navigateTo('login')">Login here</a></p>
            </div>
        </section>

        <!-- Farmer Dashboard Section -->
        <section id="farmerDashboard" class="section hidden">
            <div class="dashboard-tabs">
                <button class="tab-btn active" onclick="showFarmerTab('listings')">My Listings</button>
                <button class="tab-btn" onclick="showFarmerTab('history')">Listing History</button>
                <button class="tab-btn" onclick="showFarmerTab('recent')">Recent Purchases</button>
            </div>

            <div id="listingsTab" class="tab-content">
                <h2>My Produce Listings</h2>
                <div class="dashboard-container">
                    <div class="add-produce-container">
                        <h3>Add New Produce</h3>
                    <form id="produceForm">
                        <div class="form-group">
                            <label for="produceType">Produce Type</label>
                            <input type="text" id="produceType" required>
                        </div>
                        <div class="form-group">
                            <label for="amount">Amount</label>
                            <input type="number" id="amount" required>
                        </div>
                        <div class="form-group">
                            <label for="measurement">Measurement</label>
                            <select id="measurement" required>
                                <option value="kg">Kilograms</option>
                                <option value="lbs">Pounds</option>
                                <option value="units">Units</option>
                                <option value="boxes">Boxes</option>
                                <option value="bushels">Bushels</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="grade">Grade</label>
                            <select id="grade" required>
                                <option value="A">Grade A</option>
                                <option value="B">Grade B</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="location">Location</label>
                            <input type="text" id="location" required>
                        </div>
                        <div class="form-group">
                            <label for="price">Price per Measurement:</label>
                            <input type="number" id="price" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="threshold">Donation Threshold (%):</label>
                            <input type="number" id="threshold" required min="0" max="100" value="20">
                            <small class="form-help">When produce quantity falls below this percentage, remaining produce will be donated to a food bank.</small>
                        </div>
                        <button type="submit">Add Produce</button>
                    </form>
                </div>
                <div class="my-listings">
                    <h3>My Listings</h3>
                    <div id="produceListings"></div>
                </div>
            </div>
        </section>

        <!-- Orders Section -->
        <section id="ordersSection" class="section hidden">
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('available')">Available Produce</button>
                <button class="tab-btn" onclick="showTab('orders')">My Orders</button>
            </div>
            
            <div id="availableTab">
                <div class="filters">
                    <select id="measurementFilter">
                        <option value="">All Measurements</option>
                    </select>
                </div>
                <div id="produceGrid" class="produce-grid"></div>
            </div>
            
            <div id="ordersTab" class="hidden">
                <div id="myOrders" class="orders-grid">
                    <!-- Orders will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Consumer Dashboard Section -->
        <section id="consumerDashboard" class="section hidden">
            <div class="dashboard-tabs">
                <button class="tab-btn active" onclick="showConsumerTab('browse')">Browse Produce</button>
                <button class="tab-btn" onclick="showConsumerTab('purchases')">My Purchases</button>
            </div>

            <div id="browseTab" class="tab-content">
                <h2>Available Produce</h2>
                <div class="filters-container">
                <div class="filter-group">
                    <input type="text" id="produceTypeFilter" placeholder="Search by produce type..." class="filter-input">
                    <select id="measurementFilter">
                        <option value="">All Measurements</option>
                    </select>
                    <select id="gradeFilter">
                        <option value="">All Grades</option>
                        <option value="A">Grade A</option>
                        <option value="B">Grade B</option>
                    </select>
                    <input type="number" id="minPriceFilter" placeholder="Min Price">
                    <input type="number" id="maxPriceFilter" placeholder="Max Price">
                    <input type="text" id="locationFilter" placeholder="Search by location">
                    <select id="sortBy">
                        <option value="date">Sort by Date</option>
                        <option value="price">Sort by Price</option>
                        <option value="produceType">Sort by Type</option>
                    </select>
                    <select id="sortOrder">
                        <option value="asc">Ascending</option>
                        <option value="desc">Descending</option>
                    </select>
                </div>
                <p id="totalCount">0 items found</p>
                <div id="availableProduce" class="produce-grid"></div>
            </div>

            </div>

            <!-- My Purchases Tab -->
            <div id="purchasesTab" class="tab-content hidden">
                <h2>My Purchase History</h2>
                <div class="orders-summary">
                    <div class="summary-card">
                        <h3>Total Purchases</h3>
                        <p id="totalPurchases">0</p>
                    </div>
                    <div class="summary-card">
                        <h3>Total Spent</h3>
                        <p id="totalSpent">$0.00</p>
                    </div>
                </div>
                <div id="myPurchases" class="orders-grid"></div>
            </div>
        </section>

        <!-- Purchase Modal -->
        <div id="purchaseModal" class="modal hidden">
            <div class="modal-content">
                <span class="close" onclick="closePurchaseModal()">&times;</span>
                <h2 style="margin-bottom: 1.5rem;">Purchase Produce</h2>
                <form id="purchaseForm" onsubmit="handlePurchase(event)">
                    <input type="hidden" id="produceId">
                    <div class="form-group">
                        <label>Produce Type</label>
                        <div class="info-value" id="modalProduceType"></div>
                    </div>
                    <div class="form-group">
                        <label>Available Amount</label>
                        <div class="info-value" id="modalAvailableAmount"></div>
                    </div>
                    <div class="form-group">
                        <label>Price per <span id="modalMeasurement"></span></label>
                        <div class="info-value" id="modalPrice"></div>
                    </div>
                    <div class="form-group">
                        <label for="purchaseQuantity">Quantity to Purchase</label>
                        <input type="number" id="purchaseQuantity" required min="1" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Total Price</label>
                        <div class="info-value total-price" id="modalTotalPrice">$0.00</div>
                    </div>
                    <button type="submit" class="submit-btn">Confirm Purchase</button>
                </form>
            </div>
        </div>

    </main>

    <!-- Core utilities and authentication -->
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/produce.js"></script>
    <script src="js/orders.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/chatbot.js"></script>

    <!-- Chatbot will be dynamically inserted here by chatbot.js -->
</body>
</html>
